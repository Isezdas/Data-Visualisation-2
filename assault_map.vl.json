{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Average 8 Year Assault Crime Cases by State (2016–2023)",
  "width": 650,
  "height": 400,
  "background": "#e6f2ff",
  "projection": { "type": "mercator", "center": [109.5, 3.5], "parallels": [2, 6], "scale": 2350 },
  "layer": [
    { "data": { "sphere": {} }, "mark": { "type": "geoshape", "fill": "#dff0ff" } },
    { "data": { "graticule": { "step": [5, 5] } }, "mark": { "type": "geoshape", "stroke": "#9bbcd1", "strokeWidth": 0.6, "opacity": 0.7 } },
    {
      "data": { "url": "data/malaysia.json", "format": { "type": "topojson", "feature": "mytopojson" } },
      "mark": { "type": "geoshape", "fill": "#f4fbff", "stroke": "#9ec0d6", "strokeWidth": 0.6 }
    },
    {
      "data": { "url": "data/assault_avg.csv", "format": { "type": "csv" } },
      "transform": [
        {
          "lookup": "state",
          "from": {
            "data": {
              "values": [
                { "alias": "Penang", "canon": "Pulau Pinang" },
                { "alias": "Malacca", "canon": "Melaka" },
                { "alias": "WP Kuala Lumpur", "canon": "Kuala Lumpur" },
                { "alias": "W.P. Kuala Lumpur", "canon": "Kuala Lumpur" },
                { "alias": "WP Labuan", "canon": "Labuan" },
                { "alias": "WP Putrajaya", "canon": "Putrajaya" }
              ]
            },
            "key": "alias",
            "fields": ["canon"]
          }
        },
        { "calculate": "datum.canon ? datum.canon : datum.state", "as": "state_std" },
        {
          "lookup": "state_std",
          "from": { "data": { "url": "data/state_centroids.csv" }, "key": "state", "fields": ["lon", "lat"] }
        }
      ],
      "mark": { "type": "circle", "opacity": 0.75, "stroke": "#0f172a", "strokeWidth": 0.6 },
      "encoding": {
        "longitude": { "field": "lon" },
        "latitude": { "field": "lat" },
        "size": {
          "field": "avg_assault",
          "type": "quantitative",
          "title": "Average Assault (2016–2023)",
          "scale": { "type": "sqrt", "range": [0, 1650] }
        },
        "color": {
          "field": "avg_assault",
          "type": "quantitative",
          "title": "Average Assault (2016–2023)",
          "scale": { "scheme": "orangered" }
        },
        "tooltip": [
          { "field": "state_std", "title": "State" },
          { "field": "avg_assault", "title": "Avg Assault", "format": "," }
        ]
      }
    }
  ],
  "config": {
    "legend": { "orient": "bottom-left", "labelFontSize": 9, "titleFontSize": 10, "offset": -5 }
  }
}
